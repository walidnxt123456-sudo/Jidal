<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Talk Show</title>
    
    <!-- 1. Load Pi Network SDK -->
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>

    <!-- 2. Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 3. Load React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- 4. Load Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 5. Load Phosphor Icons (for cool graphics) -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 10px rgba(168, 85, 247, 0.2); }
            50% { box-shadow: 0 0 25px rgba(168, 85, 247, 0.6); }
        }
        .mic-active { animation: pulse-glow 2s infinite; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-gray-950 text-white font-sans antialiased selection:bg-purple-500 selection:text-white">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- EXPANDED PERSONALITIES ---
        const PERSONALITIES = [
            { id: 'elon', name: 'Elon Musk', role: 'Tech Mogul', color: 'bg-stone-800', border: 'border-stone-600', avatar: 'üöÄ', voiceType: 'male', style: 'stuttering, futuristic, talks about mars.' },
            { id: 'marx', name: 'Karl Marx', role: 'Theorist', color: 'bg-red-800', border: 'border-red-600', avatar: '‚ò≠', voiceType: 'male', style: 'passionate, talks about workers and capital.' },
            { id: 'sherlock', name: 'Sherlock', role: 'Detective', color: 'bg-slate-700', border: 'border-slate-500', avatar: 'üîç', voiceType: 'male', style: 'deductive, rapid, slightly arrogant.' },
            { id: 'batman', name: 'Batman', role: 'Vigilante', color: 'bg-gray-900', border: 'border-gray-700', avatar: 'ü¶á', voiceType: 'low', style: 'deep voice, gritty, justice-focused.' },
            { id: 'ramsay', name: 'Gordon Ramsay', role: 'Chef', color: 'bg-orange-700', border: 'border-orange-500', avatar: 'üë®‚Äçüç≥', voiceType: 'male', style: 'angry, loud, talks about raw food.' },
            { id: 'toddler', name: 'A Toddler', role: 'Agent of Chaos', color: 'bg-pink-500', border: 'border-pink-400', avatar: 'üë∂', voiceType: 'child', style: 'simple words, distracted, mentions dinosaurs.' },
            { id: 'socrates', name: 'Socrates', role: 'Philosopher', color: 'bg-emerald-800', border: 'border-emerald-600', avatar: 'üèõÔ∏è', voiceType: 'male', style: 'answers with questions, annoying.' },
            { id: 'einstein', name: 'Einstein', role: 'Physicist', color: 'bg-blue-800', border: 'border-blue-600', avatar: '‚öõÔ∏è', voiceType: 'male', style: 'gentle, german accent, talks about relativity.' },
        ];

        const TONES = [
            { id: 'friendly', label: '‚òï Friendly Chat', desc: 'A cozy conversation.' },
            { id: 'heated', label: 'üî• Heated Debate', desc: 'Sparks will fly.' },
            { id: 'academic', label: 'üéì Academic', desc: 'Deep intellectual dive.' },
        ];

        function App() {
            // --- STATE ---
            // START DIRECTLY IN GREENROOM
            const [appState, setAppState] = useState('greenRoom'); 
            const [user, setUser] = useState({ username: 'Host', uid: 'guest' });
            
            // Show Config
            const [topic, setTopic] = useState('');
            const [tone, setTone] = useState('friendly');
            const [guests, setGuests] = useState({ guestA: null, guestB: null });
            
            // Studio State
            const [messages, setMessages] = useState([]);
            const [inputText, setInputText] = useState('');
            const [isProcessing, setIsProcessing] = useState(false);
            const [audioEnabled, setAudioEnabled] = useState(true);
            const [currentSpeaker, setCurrentSpeaker] = useState(null); // 'guestA', 'guestB', or null

            const messagesEndRef = useRef(null);
            const synth = window.speechSynthesis;

            // --- INITIALIZATION ---
            useEffect(() => {
                if (window.Pi) {
                    try { window.Pi.init({ version: "2.0", sandbox: true }); } 
                    catch (err) { console.warn("Pi Init Error", err); }
                }
            }, []);

            useEffect(() => {
                messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            }, [messages, isProcessing]);

            // --- TTS HELPER ---
            const speak = (text, character) => {
                if (!audioEnabled || !synth) return;
                
                // Cancel current speech
                synth.cancel();

                const utterance = new SpeechSynthesisUtterance(text);
                const voices = synth.getVoices();
                
                // Basic voice selection logic (works differently in every browser)
                let selectedVoice = voices.find(v => v.lang.includes('en'));
                
                // Try to vary pitch/rate based on character metadata
                if (character) {
                   if (character.voiceType === 'child') {
                       utterance.pitch = 1.4;
                       utterance.rate = 1.1;
                   } else if (character.voiceType === 'low') {
                       utterance.pitch = 0.6;
                       utterance.rate = 0.9;
                   } else {
                       utterance.pitch = 1.0;
                   }
                }

                if (selectedVoice) utterance.voice = selectedVoice;
                
                // Set visual indicator
                setCurrentSpeaker(character ? (character.id === guests.guestA?.id ? 'guestA' : 'guestB') : null);

                utterance.onend = () => setCurrentSpeaker(null);
                synth.speak(utterance);
            };

            // --- HANDLERS ---

            const handleStartShow = () => {
                setMessages([{
                    id: 'intro',
                    sender: 'system',
                    text: `üéôÔ∏è Live from the Pi Studio! We are discussing "${topic}" in a ${tone} tone.`
                }]);
                setAppState('studio');
            };

            const handleEndShow = () => {
                setAppState('summary');
            };

            const handleSendMessage = () => {
                if (!inputText.trim()) return;

                const newMsg = { id: Date.now(), sender: 'host', name: user.username, text: inputText };
                setMessages(prev => [...prev, newMsg]);
                setInputText('');
                setIsProcessing(true);

                // --- MOCK AI LOGIC ---
                // 1. Determine who answers first (Random)
                const firstResponder = Math.random() > 0.5 ? 'guestA' : 'guestB';
                const secondResponder = firstResponder === 'guestA' ? 'guestB' : 'guestA';

                const g1 = guests[firstResponder];
                const g2 = guests[secondResponder];

                // 2. Simulate Response Delay
                setTimeout(() => {
                    const text1 = generateResponse(g1, topic, inputText, tone, true);
                    setMessages(prev => [...prev, { id: Date.now()+1, sender: firstResponder, name: g1.name, text: text1 }]);
                    speak(text1, g1);

                    // 3. Second guest responds to first guest
                    setTimeout(() => {
                        const text2 = generateResponse(g2, topic, text1, tone, false);
                        setMessages(prev => [...prev, { id: Date.now()+2, sender: secondResponder, name: g2.name, text: text2 }]);
                        speak(text2, g2);
                        setIsProcessing(false);
                    }, 2000 + (text1.length * 50)); // Wait based on length of first message

                }, 1500);
            };

            const generateResponse = (char, topic, context, tone, isFirst) => {
                const starters = isFirst 
                    ? ["Well, obviously", "Look,", "I must say,", "From my perspective,"]
                    : ["That is nonsense!", "I agree, but", "You miss the point,", "Listen to me,"];
                
                // Very simple mock logic to flavor text
                let content = `I am thinking about ${topic}. ${char.style}`;
                if (char.id === 'toddler') content = "Can I have a cookie? Also " + topic + " is boring.";
                if (char.id === 'batman') content = "JUSTICE requires us to consider " + topic + " carefully.";
                if (char.id === 'ramsay') content = "This opinion on " + topic + " is RAW! It's GARBAGE!";
                
                return `${starters[Math.floor(Math.random()*starters.length)]} ${content}`;
            };

            // --- VIEWS ---

            // 1. GREEN ROOM (Setup)
            if (appState === 'greenRoom') {
                return (
                    <div className="min-h-screen bg-gray-900 flex flex-col p-6 overflow-y-auto">
                        <header className="flex justify-between items-center mb-6">
                            <h1 className="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600">The Green Room</h1>
                            <div className="text-sm text-gray-400">Host: {user.username}</div>
                        </header>

                        <div className="max-w-3xl mx-auto w-full space-y-8 pb-20">
                            
                            {/* TOPIC SECTION */}
                            <section className="animate-fade-in">
                                <label className="block text-purple-400 text-xs font-bold uppercase tracking-wider mb-2">Step 1: The Topic</label>
                                <input 
                                    type="text" 
                                    value={topic}
                                    onChange={(e) => setTopic(e.target.value)}
                                    placeholder="e.g. Is a hotdog a sandwich?"
                                    className="w-full bg-gray-800 border border-gray-700 rounded-xl p-4 text-lg focus:border-purple-500 focus:outline-none focus:ring-1 focus:ring-purple-500 transition-all placeholder:text-gray-600"
                                />
                            </section>

                            {/* GUEST SELECTOR */}
                            <section className="animate-fade-in delay-100">
                                <label className="block text-purple-400 text-xs font-bold uppercase tracking-wider mb-2">Step 2: The Guests</label>
                                <div className="grid grid-cols-2 gap-4 mb-4">
                                    {['guestA', 'guestB'].map((slot, idx) => (
                                        <div key={slot} className={`p-4 rounded-xl border-2 transition-all cursor-default ${guests[slot] ? `${guests[slot].color} border-transparent` : 'bg-gray-800 border-dashed border-gray-700'}`}>
                                            <div className="text-xs text-white/50 mb-2 uppercase">Guest #{idx + 1}</div>
                                            {guests[slot] ? (
                                                <div className="flex flex-col items-center">
                                                    <div className="text-4xl mb-2">{guests[slot].avatar}</div>
                                                    <div className="font-bold text-center leading-tight">{guests[slot].name}</div>
                                                    <button onClick={() => setGuests(prev => ({...prev, [slot]: null}))} className="mt-3 text-xs bg-black/20 hover:bg-black/40 px-3 py-1 rounded-full">Remove</button>
                                                </div>
                                            ) : (
                                                <div className="text-center text-gray-500 text-sm py-4">Select Below</div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                                
                                {/* Guest Carousel/Grid */}
                                <div className="flex gap-3 overflow-x-auto pb-4 hide-scrollbar snap-x">
                                    {PERSONALITIES.map(p => {
                                        const isSelected = guests.guestA?.id === p.id || guests.guestB?.id === p.id;
                                        return (
                                            <button 
                                                key={p.id}
                                                disabled={isSelected}
                                                onClick={() => !guests.guestA ? setGuests(prev => ({...prev, guestA: p})) : !guests.guestB ? setGuests(prev => ({...prev, guestB: p})) : null}
                                                className={`snap-center flex-shrink-0 w-24 h-32 flex flex-col items-center justify-center p-2 rounded-xl border border-gray-700 bg-gray-800 transition-all ${isSelected ? 'opacity-30 grayscale' : 'hover:bg-gray-700 hover:scale-105'}`}
                                            >
                                                <div className="text-3xl mb-2">{p.avatar}</div>
                                                <div className="text-xs font-bold text-center">{p.name}</div>
                                                <div className="text-[10px] text-gray-500 text-center leading-none mt-1">{p.role}</div>
                                            </button>
                                        )
                                    })}
                                </div>
                            </section>

                            {/* TONE SELECTOR */}
                            <section className="animate-fade-in delay-200">
                                <label className="block text-purple-400 text-xs font-bold uppercase tracking-wider mb-2">Step 3: The Vibe</label>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
                                    {TONES.map(t => (
                                        <button 
                                            key={t.id}
                                            onClick={() => setTone(t.id)}
                                            className={`p-3 rounded-lg border text-left transition-all ${tone === t.id ? 'bg-purple-900/40 border-purple-500' : 'bg-gray-800 border-gray-700 hover:bg-gray-750'}`}
                                        >
                                            <div className="font-bold text-sm mb-1">{t.label}</div>
                                            <div className="text-xs text-gray-400">{t.desc}</div>
                                        </button>
                                    ))}
                                </div>
                            </section>

                            <button 
                                disabled={!guests.guestA || !guests.guestB || !topic}
                                onClick={handleStartShow}
                                className="w-full py-4 bg-gradient-to-r from-purple-600 to-pink-600 rounded-xl font-bold text-lg shadow-lg shadow-purple-900/50 hover:scale-[1.02] active:scale-95 transition-all disabled:opacity-50 disabled:grayscale"
                            >
                                Start Broadcast üéôÔ∏è
                            </button>
                        </div>
                    </div>
                );
            }

            // 2. THE STUDIO (Main Interface)
            if (appState === 'studio') {
                return (
                    <div className="fixed inset-0 bg-gray-950 flex flex-col">
                        {/* HEADER */}
                        <div className="h-14 bg-gray-900 border-b border-gray-800 flex justify-between items-center px-4 shrink-0">
                            <div className="flex items-center gap-2">
                                <div className="w-2 h-2 bg-red-500 rounded-full animate-pulse"></div>
                                <span className="font-bold text-gray-200 text-sm">LIVE</span>
                                <span className="text-xs text-gray-500 px-2 border-l border-gray-700 truncate max-w-[150px]">{topic}</span>
                            </div>
                            <div className="flex gap-3">
                                <button onClick={() => setAudioEnabled(!audioEnabled)} className={`text-xl ${audioEnabled ? 'text-purple-400' : 'text-gray-600'}`}>
                                    <i className={`ph ${audioEnabled ? 'ph-speaker-high' : 'ph-speaker-slash'}`}></i>
                                </button>
                                <button onClick={handleEndShow} className="bg-red-500/10 text-red-500 text-xs font-bold px-3 py-1.5 rounded-md hover:bg-red-500 hover:text-white transition-colors">
                                    END SHOW
                                </button>
                            </div>
                        </div>

                        {/* STAGE (Visuals) */}
                        <div className="h-48 md:h-64 bg-gray-900/50 grid grid-cols-2 gap-4 p-4 items-end justify-items-center relative border-b border-gray-800 shrink-0">
                            {/* Guest A */}
                            <div className={`relative transition-all duration-300 ${currentSpeaker === 'guestA' ? 'scale-110 z-10' : 'scale-95 opacity-80'}`}>
                                <div className={`w-24 h-24 md:w-32 md:h-32 rounded-full flex items-center justify-center text-5xl md:text-6xl border-4 shadow-xl ${guests.guestA.color} ${guests.guestA.border} ${currentSpeaker === 'guestA' ? 'shadow-purple-500/50' : ''}`}>
                                    {guests.guestA.avatar}
                                </div>
                                <div className="mt-2 text-center">
                                    <div className="font-bold text-sm">{guests.guestA.name}</div>
                                    <div className={`text-[10px] uppercase font-bold tracking-widest ${currentSpeaker === 'guestA' ? 'text-green-400' : 'text-gray-500'}`}>
                                        {currentSpeaker === 'guestA' ? 'SPEAKING' : 'LISTENING'}
                                    </div>
                                </div>
                            </div>

                            {/* Guest B */}
                            <div className={`relative transition-all duration-300 ${currentSpeaker === 'guestB' ? 'scale-110 z-10' : 'scale-95 opacity-80'}`}>
                                <div className={`w-24 h-24 md:w-32 md:h-32 rounded-full flex items-center justify-center text-5xl md:text-6xl border-4 shadow-xl ${guests.guestB.color} ${guests.guestB.border} ${currentSpeaker === 'guestB' ? 'shadow-purple-500/50' : ''}`}>
                                    {guests.guestB.avatar}
                                </div>
                                <div className="mt-2 text-center">
                                    <div className="font-bold text-sm">{guests.guestB.name}</div>
                                    <div className={`text-[10px] uppercase font-bold tracking-widest ${currentSpeaker === 'guestB' ? 'text-green-400' : 'text-gray-500'}`}>
                                        {currentSpeaker === 'guestB' ? 'SPEAKING' : 'LISTENING'}
                                    </div>
                                </div>
                            </div>

                            {/* VS Badge */}
                            <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-black/50 backdrop-blur px-2 py-1 rounded text-xs font-bold text-white/50 border border-white/10">
                                VS
                            </div>
                        </div>

                        {/* TRANSCRIPT / FEED */}
                        <div className="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-950">
                            {messages.map((msg, i) => {
                                if (msg.sender === 'system') return <div key={i} className="text-center text-xs text-gray-500 my-4 italic">{msg.text}</div>;
                                
                                const isHost = msg.sender === 'host';
                                return (
                                    <div key={msg.id} className={`flex flex-col ${isHost ? 'items-end' : 'items-start'} animate-fade-in`}>
                                        <div className="flex items-center gap-2 mb-1">
                                            <span className="text-[10px] font-bold text-gray-400 uppercase">{msg.name}</span>
                                        </div>
                                        <div className={`max-w-[85%] rounded-2xl px-4 py-2.5 text-sm leading-relaxed ${
                                            isHost ? 'bg-purple-900/50 text-purple-100 rounded-tr-sm border border-purple-500/30' : 
                                            'bg-gray-800 text-gray-200 rounded-tl-sm border border-gray-700'
                                        }`}>
                                            {msg.text}
                                        </div>
                                    </div>
                                )
                            })}
                            {isProcessing && (
                                <div className="flex items-center gap-2 text-gray-500 text-xs ml-2">
                                    <i className="ph ph-spinner animate-spin"></i>
                                    <span>Guests are thinking...</span>
                                </div>
                            )}
                            <div ref={messagesEndRef} />
                        </div>

                        {/* CONTROLS */}
                        <div className="p-4 bg-gray-900 border-t border-gray-800 shrink-0">
                            <form 
                                onSubmit={(e) => { e.preventDefault(); handleSendMessage(); }}
                                className="flex gap-3 items-center max-w-2xl mx-auto"
                            >
                                <div className="w-10 h-10 rounded-full bg-gray-800 border border-gray-700 flex items-center justify-center shrink-0">
                                    <span className="text-xl">üéôÔ∏è</span>
                                </div>
                                <div className="flex-1 relative">
                                    <input 
                                        type="text" 
                                        value={inputText}
                                        onChange={e => setInputText(e.target.value)}
                                        placeholder="Push to ask a question..."
                                        disabled={isProcessing}
                                        className="w-full bg-gray-950 text-white border border-gray-700 rounded-full h-12 pl-4 pr-12 focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500 disabled:opacity-50"
                                    />
                                    <button 
                                        type="submit"
                                        disabled={!inputText.trim() || isProcessing}
                                        className="absolute right-1 top-1 w-10 h-10 bg-purple-600 hover:bg-purple-500 rounded-full flex items-center justify-center transition-all disabled:opacity-0 disabled:scale-75"
                                    >
                                        <i className="ph ph-paper-plane-right text-lg text-white"></i>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                );
            }

            // 3. WRAP UP (Summary)
            if (appState === 'summary') {
                return (
                    <div className="min-h-screen bg-gray-900 flex flex-col items-center justify-center p-6 text-center">
                        <div className="w-20 h-20 bg-gradient-to-tr from-purple-500 to-pink-500 rounded-3xl flex items-center justify-center mb-6 shadow-2xl shadow-purple-500/20 rotate-3">
                            <span className="text-4xl">üìº</span>
                        </div>
                        <h1 className="text-3xl font-black text-white mb-2">That's a Wrap!</h1>
                        <p className="text-gray-400 mb-8 max-w-md">The episode featuring {guests.guestA?.name} and {guests.guestB?.name} has been recorded.</p>
                        
                        <div className="bg-gray-800 rounded-2xl p-6 w-full max-w-md border border-gray-700 mb-8 text-left">
                            <div className="flex justify-between items-start mb-4">
                                <div>
                                    <div className="text-xs text-purple-400 font-bold uppercase tracking-wider mb-1">Episode Summary</div>
                                    <div className="font-bold text-lg text-white">"{topic}"</div>
                                </div>
                                <div className="bg-black/30 px-2 py-1 rounded text-xs text-gray-400">{tone}</div>
                            </div>
                            <div className="h-1 w-full bg-gray-700 rounded-full mb-4 overflow-hidden">
                                <div className="h-full bg-purple-500 w-2/3"></div>
                            </div>
                            <div className="space-y-3">
                                <div className="flex items-center gap-3 text-sm text-gray-300">
                                    <span className="text-xl">{guests.guestA?.avatar}</span>
                                    <span>Argued passionately for the cause.</span>
                                </div>
                                <div className="flex items-center gap-3 text-sm text-gray-300">
                                    <span className="text-xl">{guests.guestB?.avatar}</span>
                                    <span>Disagreed with everything.</span>
                                </div>
                            </div>
                        </div>

                        <div className="flex gap-4 w-full max-w-md">
                            <button onClick={() => setAppState('greenRoom')} className="flex-1 py-3 rounded-xl border border-gray-600 hover:bg-gray-800 text-white font-bold transition-all">
                                New Episode
                            </button>
                            <button onClick={() => alert("Shared to Pi Feed!")} className="flex-1 py-3 rounded-xl bg-purple-600 hover:bg-purple-500 text-white font-bold shadow-lg shadow-purple-500/25 transition-all">
                                Share Clip
                            </button>
                        </div>
                    </div>
                );
            }

            return null; // Should not reach here if state is correct
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
