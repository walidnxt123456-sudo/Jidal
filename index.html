<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Talk Show</title>
    
    <!-- 1. Load Pi Network SDK -->
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>

    <!-- 2. Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 3. Load React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- 4. Load Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 5. Load Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 10px rgba(168, 85, 247, 0.2); }
            50% { box-shadow: 0 0 25px rgba(168, 85, 247, 0.6); }
        }
        @keyframes pop-in {
            0% { transform: scale(0); opacity: 0; }
            80% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes bounce-dots {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        .mic-active { animation: pulse-glow 2s infinite; }
        .bubble-pop { animation: pop-in 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        .dot-1 { animation: bounce-dots 0.6s infinite 0.1s; }
        .dot-2 { animation: bounce-dots 0.6s infinite 0.2s; }
        .dot-3 { animation: bounce-dots 0.6s infinite 0.3s; }
        
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .tv-scanline {
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.1) 50%, rgba(0,0,0,0.1));
            background-size: 100% 4px;
            pointer-events: none;
        }
    </style>
</head>
<body class="bg-gray-950 text-white font-sans antialiased selection:bg-purple-500 selection:text-white overflow-hidden">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- TYPEWRITER COMPONENT ---
        // Renders text character by character
        const Typewriter = ({ text, speed = 30 }) => {
            const [displayed, setDisplayed] = useState('');
            
            useEffect(() => {
                setDisplayed(''); // Reset on new text
                let i = 0;
                const timer = setInterval(() => {
                    if (i < text.length) {
                        setDisplayed((prev) => prev + text.charAt(i));
                        i++;
                    } else {
                        clearInterval(timer);
                    }
                }, speed);
                return () => clearInterval(timer);
            }, [text]);

            return <span>{displayed}</span>;
        };

        // --- PERSONALITIES WITH VOICE PREFS ---
        const PERSONALITIES = [
            { id: 'elon', name: 'Elon Musk', role: 'Tech Mogul', color: 'bg-stone-800', border: 'border-stone-600', avatar: 'üöÄ', voiceOffset: 0, pitch: 1, style: 'stuttering, futuristic, talks about mars.' },
            { id: 'marx', name: 'Karl Marx', role: 'Theorist', color: 'bg-red-800', border: 'border-red-600', avatar: '‚ò≠', voiceOffset: 1, pitch: 0.8, style: 'passionate, talks about workers and capital.' },
            { id: 'sherlock', name: 'Sherlock', role: 'Detective', color: 'bg-slate-700', border: 'border-slate-500', avatar: 'üîç', voiceOffset: 2, pitch: 1.1, style: 'deductive, rapid, slightly arrogant.' },
            { id: 'batman', name: 'Batman', role: 'Vigilante', color: 'bg-gray-900', border: 'border-gray-700', avatar: 'ü¶á', voiceOffset: 3, pitch: 0.5, style: 'deep voice, gritty, justice-focused.' },
            { id: 'ramsay', name: 'Gordon Ramsay', role: 'Chef', color: 'bg-orange-700', border: 'border-orange-500', avatar: 'üë®‚Äçüç≥', voiceOffset: 4, pitch: 1.2, style: 'angry, loud, talks about raw food.' },
            { id: 'toddler', name: 'A Toddler', role: 'Agent of Chaos', color: 'bg-pink-500', border: 'border-pink-400', avatar: 'üë∂', voiceOffset: 5, pitch: 1.6, style: 'simple words, distracted, mentions dinosaurs.' },
            { id: 'socrates', name: 'Socrates', role: 'Philosopher', color: 'bg-emerald-800', border: 'border-emerald-600', avatar: 'üèõÔ∏è', voiceOffset: 6, pitch: 0.9, style: 'answers with questions, annoying.' },
            { id: 'einstein', name: 'Einstein', role: 'Physicist', color: 'bg-blue-800', border: 'border-blue-600', avatar: '‚öõÔ∏è', voiceOffset: 7, pitch: 1.0, style: 'gentle, german accent, talks about relativity.' },
        ];

        const TONES = [
            { id: 'friendly', label: '‚òï Friendly Chat', desc: 'A cozy conversation.' },
            { id: 'heated', label: 'üî• Heated Debate', desc: 'Sparks will fly.' },
            { id: 'academic', label: 'üéì Academic', desc: 'Deep intellectual dive.' },
        ];

        function App() {
            // --- STATE ---
            const [appState, setAppState] = useState('greenRoom'); 
            const [user, setUser] = useState({ username: 'Host', uid: 'guest', avatar: 'üé§' });
            
            const [topic, setTopic] = useState('');
            const [tone, setTone] = useState('friendly');
            const [guests, setGuests] = useState({ guestA: null, guestB: null });
            
            const [messages, setMessages] = useState([]);
            const [inputText, setInputText] = useState('');
            const [isProcessing, setIsProcessing] = useState(false);
            const [audioEnabled, setAudioEnabled] = useState(true);
            const [currentSpeaker, setCurrentSpeaker] = useState(null); 
            const [thinkingGuest, setThinkingGuest] = useState(null); // 'guestA' or 'guestB'

            const [availableVoices, setAvailableVoices] = useState([]);
            const synth = window.speechSynthesis;

            // --- INITIALIZATION ---
            useEffect(() => {
                if (window.Pi) {
                    try { window.Pi.init({ version: "2.0", sandbox: true }); } 
                    catch (err) { console.warn("Pi Init Error", err); }
                }

                // Load Voices
                const loadVoices = () => {
                    const voices = synth.getVoices();
                    if (voices.length > 0) {
                        // Filter for English voices to ensure intelligibility
                        const englishVoices = voices.filter(v => v.lang.startsWith('en'));
                        setAvailableVoices(englishVoices.length ? englishVoices : voices);
                    }
                };
                loadVoices();
                if (synth.onvoiceschanged !== undefined) {
                    synth.onvoiceschanged = loadVoices;
                }
            }, []);

            // --- TTS HELPER ---
            const speak = (text, character) => {
                if (!audioEnabled || !synth) return;
                synth.cancel();

                const utterance = new SpeechSynthesisUtterance(text);
                
                // Smart Voice Assignment
                if (character && availableVoices.length > 0) {
                    // Use the character's specific offset to pick a unique voice deterministically
                    // If we run out of voices, wrap around using modulo
                    const voiceIndex = character.voiceOffset % availableVoices.length;
                    utterance.voice = availableVoices[voiceIndex];
                    utterance.pitch = character.pitch || 1.0;
                    
                    // Slight rate randomization for natural feel
                    utterance.rate = 0.9 + (Math.random() * 0.2); 
                }
                
                setCurrentSpeaker(character ? (character.id === guests.guestA?.id ? 'guestA' : 'guestB') : 'host');
                utterance.onend = () => setCurrentSpeaker(null);
                synth.speak(utterance);
            };

            // --- HANDLERS ---
            const handleStartShow = () => {
                setMessages([{
                    id: 'intro',
                    sender: 'system',
                    text: `üéôÔ∏è Show Starting... Topic: ${topic}`
                }]);
                setAppState('studio');
            };

            const handleSendMessage = () => {
                if (!inputText.trim()) return;

                const newMsg = { id: Date.now(), sender: 'host', name: user.username, text: inputText };
                setMessages(prev => [...prev, newMsg]);
                setInputText('');
                setIsProcessing(true);
                setCurrentSpeaker('host');

                const firstResponder = Math.random() > 0.5 ? 'guestA' : 'guestB';
                const secondResponder = firstResponder === 'guestA' ? 'guestB' : 'guestA';
                const g1 = guests[firstResponder];
                const g2 = guests[secondResponder];

                // GUEST 1 THINKING
                setTimeout(() => {
                    setThinkingGuest(firstResponder);
                    
                    // GUEST 1 SPEAKS
                    setTimeout(() => {
                        setThinkingGuest(null);
                        const text1 = generateResponse(g1, topic, inputText, tone, true);
                        setMessages(prev => [...prev, { id: Date.now()+1, sender: firstResponder, name: g1.name, text: text1 }]);
                        speak(text1, g1);

                        // GUEST 2 THINKING
                        setTimeout(() => {
                            setThinkingGuest(secondResponder);

                            // GUEST 2 SPEAKS
                            setTimeout(() => {
                                setThinkingGuest(null);
                                const text2 = generateResponse(g2, topic, text1, tone, false);
                                setMessages(prev => [...prev, { id: Date.now()+2, sender: secondResponder, name: g2.name, text: text2 }]);
                                speak(text2, g2);
                                setIsProcessing(false);
                            }, 2000); // Thinking time for guest 2

                        }, 1000 + (text1.length * 50)); // Wait for guest 1 to finish

                    }, 1500); // Thinking time for guest 1

                }, 1000);
            };

            const generateResponse = (char, topic, context, tone, isFirst) => {
                const starters = isFirst 
                    ? ["Well,", "Look,", "I believe", "Actually,"]
                    : ["That is wrong!", "I agree, but", "Nonsense!", "Listen,"];
                
                let content = `I have strong thoughts on ${topic}. ${char.style}`;
                if (char.id === 'toddler') content = "I want juice! " + topic + " is silly.";
                if (char.id === 'batman') content = "JUSTICE demands we look at " + topic + ".";
                if (char.id === 'ramsay') content = topic + " is RAW! DISGUSTING!";
                
                return `${starters[Math.floor(Math.random()*starters.length)]} ${content}`;
            };

            const getLastMessage = (sender) => {
                return messages.filter(m => m.sender === sender).pop();
            };

            // --- VIEWS ---

            // 1. GREEN ROOM (Setup)
            if (appState === 'greenRoom') {
                return (
                    <div className="min-h-screen bg-gray-900 flex flex-col p-6 overflow-y-auto">
                        <header className="flex justify-between items-center mb-6">
                            <h1 className="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600">The Green Room</h1>
                            <div className="text-sm text-gray-400">Host: {user.username}</div>
                        </header>

                        <div className="max-w-3xl mx-auto w-full space-y-8 pb-20">
                            <section className="animate-fade-in">
                                <label className="block text-purple-400 text-xs font-bold uppercase tracking-wider mb-2">Step 1: The Topic</label>
                                <input type="text" value={topic} onChange={(e) => setTopic(e.target.value)} placeholder="e.g. Is a hotdog a sandwich?"
                                    className="w-full bg-gray-800 border border-gray-700 rounded-xl p-4 text-lg focus:border-purple-500 focus:outline-none" />
                            </section>

                            <section className="animate-fade-in delay-100">
                                <label className="block text-purple-400 text-xs font-bold uppercase tracking-wider mb-2">Step 2: The Guests</label>
                                <div className="grid grid-cols-2 gap-4 mb-4">
                                    {['guestA', 'guestB'].map((slot, idx) => (
                                        <div key={slot} className={`p-4 rounded-xl border-2 transition-all ${guests[slot] ? `${guests[slot].color} border-transparent` : 'bg-gray-800 border-dashed border-gray-700'}`}>
                                            <div className="text-xs text-white/50 mb-2 uppercase">Guest #{idx + 1}</div>
                                            {guests[slot] ? (
                                                <div className="flex flex-col items-center text-center">
                                                    <div className="text-4xl mb-2">{guests[slot].avatar}</div>
                                                    <div className="font-bold">{guests[slot].name}</div>
                                                    <button onClick={() => setGuests(prev => ({...prev, [slot]: null}))} className="mt-3 text-xs bg-black/20 hover:bg-black/40 px-3 py-1 rounded-full">Remove</button>
                                                </div>
                                            ) : ( <div className="text-center text-gray-500 text-sm py-4">Select Below</div> )}
                                        </div>
                                    ))}
                                </div>
                                <div className="flex gap-3 overflow-x-auto pb-4 hide-scrollbar snap-x">
                                    {PERSONALITIES.map(p => {
                                        const isSelected = guests.guestA?.id === p.id || guests.guestB?.id === p.id;
                                        return (
                                            <button key={p.id} disabled={isSelected} onClick={() => !guests.guestA ? setGuests(prev => ({...prev, guestA: p})) : !guests.guestB ? setGuests(prev => ({...prev, guestB: p})) : null}
                                                className={`snap-center flex-shrink-0 w-24 h-32 flex flex-col items-center justify-center p-2 rounded-xl border border-gray-700 bg-gray-800 transition-all ${isSelected ? 'opacity-30 grayscale' : 'hover:bg-gray-700'}`}>
                                                <div className="text-3xl mb-2">{p.avatar}</div>
                                                <div className="text-xs font-bold text-center">{p.name}</div>
                                            </button>
                                        )
                                    })}
                                </div>
                            </section>

                            <section className="animate-fade-in delay-200">
                                <label className="block text-purple-400 text-xs font-bold uppercase tracking-wider mb-2">Step 3: The Vibe</label>
                                <div className="grid grid-cols-3 gap-3">
                                    {TONES.map(t => (
                                        <button key={t.id} onClick={() => setTone(t.id)} className={`p-3 rounded-lg border text-left transition-all ${tone === t.id ? 'bg-purple-900/40 border-purple-500' : 'bg-gray-800 border-gray-700'}`}>
                                            <div className="font-bold text-sm mb-1">{t.label}</div>
                                        </button>
                                    ))}
                                </div>
                            </section>

                            <button disabled={!guests.guestA || !guests.guestB || !topic} onClick={handleStartShow}
                                className="w-full py-4 bg-gradient-to-r from-purple-600 to-pink-600 rounded-xl font-bold text-lg shadow-lg hover:scale-[1.02] transition-all disabled:opacity-50">
                                Start Broadcast üéôÔ∏è
                            </button>
                        </div>
                    </div>
                );
            }

            // 2. TV SCREEN STUDIO
            if (appState === 'studio') {
                const hostMsg = getLastMessage('host');
                const guestAMsg = getLastMessage('guestA');
                const guestBMsg = getLastMessage('guestB');

                return (
                    <div className="fixed inset-0 bg-black flex flex-col relative">
                        {/* TV Scanline Overlay */}
                        <div className="absolute inset-0 tv-scanline z-10 pointer-events-none"></div>

                        {/* Header */}
                        <div className="absolute top-0 left-0 w-full p-4 z-20 flex justify-between items-start">
                            <div className="flex items-center gap-2 bg-red-600 text-white px-3 py-1 rounded font-bold text-xs uppercase tracking-widest animate-pulse">
                                Live
                            </div>
                            <button onClick={() => setAppState('greenRoom')} className="text-gray-500 hover:text-white bg-black/50 rounded-full p-2"><i className="ph ph-power text-xl"></i></button>
                        </div>

                        {/* MAIN TV AREA */}
                        <div className="flex-1 relative p-4 flex flex-col justify-between bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] bg-gray-900">
                            
                            {/* TOP: HOST */}
                            <div className="flex flex-col items-center justify-start pt-8 relative z-0 h-1/3">
                                <div className={`relative transition-all duration-300 ${currentSpeaker === 'host' ? 'scale-110' : 'scale-100'}`}>
                                    <div className="w-20 h-20 rounded-full border-4 border-purple-500 bg-gray-800 flex items-center justify-center text-4xl shadow-2xl z-10 relative">
                                        {user.avatar}
                                    </div>
                                    <div className="absolute -bottom-2 left-1/2 transform -translate-x-1/2 bg-purple-600 text-white text-[10px] font-bold px-2 rounded uppercase">
                                        YOU
                                    </div>
                                </div>
                                {hostMsg && (
                                    <div className="mt-4 bg-purple-600 text-white p-4 rounded-2xl rounded-t-none max-w-xs text-center text-sm shadow-lg bubble-pop relative border border-purple-400">
                                        "{hostMsg.text}"
                                        <div className="absolute -top-2 left-1/2 transform -translate-x-1/2 w-4 h-4 bg-purple-600 rotate-45"></div>
                                    </div>
                                )}
                            </div>

                            {/* BOTTOM: GUESTS */}
                            <div className="flex-1 flex items-end justify-between pb-24 gap-4">
                                
                                {/* GUEST A (LEFT) */}
                                <div className="flex flex-col items-start w-1/2 relative">
                                    <div className={`flex items-center gap-3 transition-all duration-300 z-20 ${currentSpeaker === 'guestA' || thinkingGuest === 'guestA' ? 'scale-105' : 'scale-100 opacity-90'}`}>
                                        <div className={`w-24 h-24 md:w-32 md:h-32 rounded-full border-4 ${guests.guestA.border} ${guests.guestA.color} flex items-center justify-center text-5xl shadow-2xl`}>
                                            {guests.guestA.avatar}
                                        </div>
                                        <div className="bg-black/60 backdrop-blur px-3 py-1 rounded border-l-4 border-white">
                                            <div className="text-white font-black uppercase text-sm">{guests.guestA.name}</div>
                                            <div className="text-gray-400 text-[10px] uppercase">{guests.guestA.role}</div>
                                        </div>
                                    </div>
                                    
                                    {/* Message or Thinking Bubble */}
                                    <div className="relative -mt-4 ml-8 z-10">
                                        {thinkingGuest === 'guestA' && (
                                            <div className="bg-gray-800 border border-gray-600 p-3 rounded-2xl rounded-tl-none text-white shadow-lg bubble-pop flex gap-1 items-center">
                                                <div className="w-2 h-2 bg-gray-400 rounded-full dot-1"></div>
                                                <div className="w-2 h-2 bg-gray-400 rounded-full dot-2"></div>
                                                <div className="w-2 h-2 bg-gray-400 rounded-full dot-3"></div>
                                            </div>
                                        )}
                                        
                                        {guestAMsg && thinkingGuest !== 'guestA' && (
                                            <div className={`p-4 rounded-2xl rounded-tl-none max-w-[90%] text-sm shadow-lg bubble-pop border ${guests.guestA.color.replace('bg-','border-').replace('800','500')} bg-gray-800 text-white`}>
                                                <Typewriter text={guestAMsg.text} speed={30} />
                                            </div>
                                        )}
                                    </div>
                                </div>

                                {/* GUEST B (RIGHT) */}
                                <div className="flex flex-col items-end w-1/2 relative">
                                    <div className={`flex flex-row-reverse items-center gap-3 transition-all duration-300 z-20 ${currentSpeaker === 'guestB' || thinkingGuest === 'guestB' ? 'scale-105' : 'scale-100 opacity-90'}`}>
                                        <div className={`w-24 h-24 md:w-32 md:h-32 rounded-full border-4 ${guests.guestB.border} ${guests.guestB.color} flex items-center justify-center text-5xl shadow-2xl`}>
                                            {guests.guestB.avatar}
                                        </div>
                                        <div className="bg-black/60 backdrop-blur px-3 py-1 rounded border-r-4 border-white text-right">
                                            <div className="text-white font-black uppercase text-sm">{guests.guestB.name}</div>
                                            <div className="text-gray-400 text-[10px] uppercase">{guests.guestB.role}</div>
                                        </div>
                                    </div>

                                    {/* Message or Thinking Bubble */}
                                    <div className="relative -mt-4 mr-8 z-10 flex flex-col items-end">
                                        {thinkingGuest === 'guestB' && (
                                            <div className="bg-gray-800 border border-gray-600 p-3 rounded-2xl rounded-tr-none text-white shadow-lg bubble-pop flex gap-1 items-center">
                                                <div className="w-2 h-2 bg-gray-400 rounded-full dot-1"></div>
                                                <div className="w-2 h-2 bg-gray-400 rounded-full dot-2"></div>
                                                <div className="w-2 h-2 bg-gray-400 rounded-full dot-3"></div>
                                            </div>
                                        )}

                                        {guestBMsg && thinkingGuest !== 'guestB' && (
                                            <div className={`p-4 rounded-2xl rounded-tr-none max-w-[90%] text-sm shadow-lg bubble-pop border ${guests.guestB.color.replace('bg-','border-').replace('800','500')} bg-gray-800 text-white text-right`}>
                                                <Typewriter text={guestBMsg.text} speed={30} />
                                            </div>
                                        )}
                                    </div>
                                </div>

                            </div>
                        </div>

                        {/* INPUT CONTROLS */}
                        <div className="absolute bottom-0 left-0 w-full p-4 bg-black/80 backdrop-blur border-t border-white/10 z-30">
                            <form onSubmit={(e) => { e.preventDefault(); handleSendMessage(); }} className="flex gap-3 items-center max-w-2xl mx-auto">
                                <input type="text" value={inputText} onChange={e => setInputText(e.target.value)} placeholder="Ask the guests..." disabled={isProcessing}
                                    className="flex-1 bg-gray-900 text-white border border-gray-700 rounded-full h-12 pl-6 pr-12 focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500 disabled:opacity-50" />
                                <button type="submit" disabled={!inputText.trim() || isProcessing} className="w-12 h-12 bg-purple-600 hover:bg-purple-500 rounded-full flex items-center justify-center transition-all disabled:grayscale">
                                    <i className="ph ph-paper-plane-right text-lg text-white"></i>
                                </button>
                            </form>
                        </div>
                    </div>
                );
            }

            return null; 
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
